---
name: dot-ai-workspace-scan
description: Scan .ai/ directories and generate compact workspace overview
triggers: [boot]
internal: true
parent: dot-ai
---

# dot-ai-workspace-scan â€” Workspace Discovery

This sub-skill handles **Phase 2 of the boot sequence** from `dot-ai`.
It scans the workspace for `.ai/` directories and builds a compact overview
that stays in memory for prompt routing.

## When to Run

- At every session start (boot trigger)
- Called automatically by the `dot-ai` boot sequence after Phase 1 (root context)

## Scan Process

### Step 1 â€” Find all `.ai/` directories

```bash
find . -name ".ai" -type d -maxdepth 3
```

Exclude the root `.ai/` from results â€” it's already loaded in Phase 1.

### Step 2 â€” Read project metadata

For each `.ai/` directory found:

1. **Read frontmatter only** from `AGENT.md`:
   ```yaml
   ---
   name: <project-name>
   description: <one-line description>
   tags: [tag1, tag2]
   ---
   ```
   Stop reading after the closing `---`. Do NOT load the full file.

2. **List skill directories**:
   ```bash
   ls <project>/.ai/skills/
   ```

3. **Read skill frontmatter** for each skill found:
   ```yaml
   ---
   name: <skill-name>
   description: <one-line description>
   triggers: [manual, heartbeat, cron]
   ---
   ```
   Again, frontmatter only.

### Step 3 â€” Build the overview

Format each project as:
```
ğŸ“ <name> â€” <description> [<tags>]
   ğŸ“‹ <skill> â€” <description> [<triggers>]
```

Example output:
```
ğŸ“ pro â€” Blog smartsdlc.dev, DX consulting [blog, dx, ai]
   ğŸ“‹ medium-digest â€” Digest articles Medium/Substack [heartbeat, cron]
   ğŸ“‹ write-blog-article â€” Workflow article blog [manual]
ğŸ“ roule-caillou â€” Projet de vie, recherche terrain [immobilier, van]
   ğŸ“‹ property-search â€” Veille biens immobiliers [cron]
ğŸ“ todo â€” TÃ¢ches perso [tasks]
   ğŸ“‹ todo â€” TÃ¢ches rapides [manual]
```

## Output Rules

### In-Memory Overview
- **Target budget**: ~300 tokens for the entire overview
- Used by `dot-ai` routing during current session to match prompts to projects
- If a project has no `AGENT.md` or no frontmatter, skip it with a warning

### Persistent Index File

**ALSO write** the overview to `.ai/memory/projects-index.md` using markers:

```markdown
<!-- dot-ai-workspace-scan start -->
<!-- Auto-generated by dot-ai-workspace-scan. Do not edit between markers. -->

# ğŸ—ºï¸ Projects Index

Index auto-gÃ©nÃ©rÃ© des projets du monorepo. UtilisÃ© pour le routing contextuel.
Chaque projet vit dans `projects/<name>/` et a son propre `.ai/AGENT.md`.

## Projets

| Projet | Description | Keywords |
|--------|-------------|----------|
| dashboard | Dashboard monitoring Kiwi â€” Astro 5 + Tailwind SSG | dashboard, stats, monitoring |
| pro | Personal brand smartsdlc.dev â€” blog, CV, articles | blog, dx, ai, smartsdlc |
...

## Skills par projet

### pro
- `medium-digest` â†’ collecte emails Medium/Substack, JSON | "medium", "digest"
- `write-blog-article` â†’ workflow article blog | "Ã©cris un article", "blog post"
...

*Last updated: YYYY-MM-DD HH:MM*

<!-- dot-ai-workspace-scan end -->
```

**Rationale:**
- Persistent index allows quick routing without re-scanning at every boot
- Agents can read the cached index file (fast) instead of scanning entire workspace
- Audit compares this file vs actual scan to detect drift
- Humans can also read this file to understand workspace structure

**Update strategy:**
- Generate at boot if file missing or >7 days old
- Manual trigger: "rescan workspace", "update projects index"
- Audit triggers re-scan if drift detected

## Error Handling

- Missing `AGENT.md` â†’ log `âš ï¸ <path>/.ai/ has no AGENT.md` and skip
- Missing frontmatter â†’ log `âš ï¸ <path>/AGENT.md has no frontmatter` and skip
- No skills found â†’ show project with no skill lines (that's fine)

## Relationship to Other Sub-skills

- `dot-ai-audit` may call this scan to compare with cached indexes
- `dot-ai-agent-sync` generates the AGENT.md files that this skill reads
