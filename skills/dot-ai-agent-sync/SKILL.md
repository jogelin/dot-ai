---
name: dot-ai-agent-sync
description: Generate and maintain AGENT.md for projects (metadata, structure, data index, skills overview)
triggers: [manual, audit]
internal: true
disable-model-invocation: true
parent: dot-ai
---

# dot-ai-agent-sync — AGENT.md Generator

Generates and maintains `AGENT.md` files in project `.ai/` directories.
Uses markers to manage auto-generated sections while preserving manual content.

## When to Run

- **Manual**: "sync agent-md for `<project>`" or "reindex `<project>`"
- **Audit**: called by `dot-ai-audit` when staleness is detected

## Marker Pattern

All auto-managed content lives between markers:

```markdown
<!-- dot-ai-agent-sync start -->
...auto-generated content...
<!-- dot-ai-agent-sync end -->
```

**Content OUTSIDE markers is NEVER touched.** This preserves manually written
sections like Rules, Conventions, Workflows, etc.

## Auto-Generated Sections

### 1. Metadata (Frontmatter)

```yaml
---
name: <inferred-from-directory-name>
description: <inferred-from-content>
tags: [<inferred>]
---
```

Inference rules:
- `name` → directory name (e.g., `projects/pro` → `pro`)
- `description` → from README.md first line, package.json description, or existing AGENT.md
- `tags` → inferred from tech stack, file types, existing config

**If frontmatter already exists**, preserve it. Only update if explicitly asked.

### 2. Directory Structure

Auto-scan the project tree, excluding noise:

```bash
# Excluded directories
node_modules, .git, .next, dist, build, __pycache__,
.cache, .turbo, coverage, .nyc_output, vendor, tmp
```

Format:
```
## Directory Structure

\```
<project>/
├── src/
│   ├── components/
│   └── pages/
├── data/
├── .ai/
│   └── skills/
└── package.json
\```
```

**Max depth**: 3 levels. Truncate deeper structures with `...`.

### 3. Data Overview

Summarize files in the project's `data/` directory:

```markdown
## Data Overview

| File | Type | Stats |
|------|------|-------|
| properties.json | JSON | 47 items, updated 2026-02-03 |
| BACKLOG.md | Markdown | 12 tasks (3 open, 9 done) |
| meetings/ | Directory | 5 files |
```

Rules:
- **MAX 20 lines**. If more files → group by type and summarize
- For JSON arrays: count items
- For Markdown: count sections or tasks
- For directories: count files
- Show last modified date for each entry
- Skip empty files

### 4. Skills

List all skills found in `<project>/.ai/skills/`:

```markdown
## Skills

| Skill | Description | Triggers |
|-------|-------------|----------|
| medium-digest | Digest articles Medium/Substack | heartbeat, cron |
| write-blog-article | Workflow article blog | manual |
```

Read frontmatter from each `SKILL.md` to populate the table.

## Full Output Template

```markdown
<!-- dot-ai-agent-sync start -->
<!-- Auto-generated by dot-ai-agent-sync. Do not edit between markers. -->

## Directory Structure

\```
...
\```

## Data Overview

| File | Type | Stats |
|------|------|-------|
| ... | ... | ... |

## Skills

| Skill | Description | Triggers |
|-------|-------------|----------|
| ... | ... | ... |

*Last synced: YYYY-MM-DD*

<!-- dot-ai-agent-sync end -->
```

## Behavior

### New AGENT.md (file doesn't exist)
1. Generate frontmatter from project content
2. Add markers with all auto-generated sections
3. Add a placeholder for manual sections below markers

### Existing AGENT.md
1. Find markers. If present → replace content between them
2. If no markers found → append markers + content at the end
3. **NEVER modify content outside markers**

### Staleness Check

Called by `dot-ai-audit` to check freshness:
- Compare "Last synced" date in markers vs latest file modification in `data/`
- If data is newer than last sync → flag as stale
- If stale → re-run sync automatically (auto-generated content only)

## Commands

| Command | Action |
|---------|--------|
| "sync agent-md for `<project>`" | Full sync of one project |
| "reindex `<project>`" | Alias for sync |
| "sync all agents" | Sync all projects with `.ai/` |
